let User = require("../database/model/users");
let shortid = require('shortid');
let { invalidRes } = require('../config');
let flag, i;

//data validation of login or signup page 
const bodyDataValidCred = (req, res, next)=>{
	invalidRes.data = "Invalid User Details";
	flag = true;
	for (i in req.body)
		flag = (req.body[`${i}`] != ('' || null)) ? true: false; 
	flag ? next():res.status(302).redirect(`/login-signup/q=${invalidRes.data}`);
}; 

//data validation 
const bodyDataValidJSON = (req, res, next)=>{
	invalidRes.data = "Invalid Data";
	flag = true;
	for (i in req.body)
		flag = (req.body[`${i}`] != ('' || null)) ? true: false; 
	flag ? next():res.json(invalidRes);
}; 

//user cookies validation
const cookieValid = (req, res, next) =>{
	//extracting cookies from req parameter
  	let cookie = req.cookies.token;
	if (cookie != null){
		/*.populate("notes")*/
		User.findOne({cookie}).exec((err, data)=>{
			if (err) throw console.error.bind(err);
			if (data){
				req.data = data;
				//calling next process
				next();
			}else
				res.status(302).redirect("/login-signup");		  
		});	
	}else
		res.status(302).redirect("/login-signup");
};

//uid validation generated by shortid
const validId = (req, res, next) => {
	flag = true;
	//console.log(req.params);
	for(i in req.params){
		//console.log(shortid.isValid(req.params[`${i}`]), req.params[`${i}`]);
		flag = (shortid.isValid(req.params[`${i}`])) ? true: false;
	}
	//console.log(flag);
	flag ? next():res.json(invalidRes);
};

module.exports = { bodyDataValidCred, bodyDataValidJSON, validId, cookieValid };